# Активный контекст

## Текущий фокус работы
Завершено комплексное улучшение интерфейса окна настроек и создание релиза v1.1.0. Проект готов к использованию и распространению.

## Последние изменения
*   **Добавлена третья вкладка "Буфер и Хоткеи"** в окно настроек с настройками изображений и горячими клавишами.
*   **Добавлен жирный заголовок "Настройки изображения"** для лучшей организации элементов управления.
*   **Центрирована кнопка "Тест соединения"** на вкладке SFTP для улучшения визуального баланса.
*   **Уменьшена высота окна настроек** с 500 до 380 пикселей для более компактного интерфейса.
*   **Обновлены constraints** для правильного позиционирования всех элементов в трех вкладках.
*   **Создан релиз v1.1.0** на GitHub с готовым приложением для скачивания.
*   **Оптимизирована структура настроек** - элементы логически распределены по трем специализированным вкладкам.
*   **Исправлена проблема с ограничением размера файла** - добавлена проверка в `FolderMonitor.swift` для файлов из отслеживаемой папки и при перетаскивании.
*   **Обновлена логика перемещения файлов:** Теперь только файлы из отслеживаемой папки перемещаются в "Uploaded" или "Error". Файлы, загруженные через Drag & Drop или из буфера обмена, остаются на своих местах.

## Следующие шаги
*   Ожидание новых задач от пользователя.

## Активные решения и соображения
*   Использование `NSApplication.ActivationPolicy` для управления видимостью приложения в доке и его поведением.
*   Перехват события перетаскивания файлов на иконку в доке для запуска загрузки.
*   Программное изменение политики активации после завершения фоновой задачи (загрузки файла) для возвращения приложения в "невидимое" состояние.
*   Многочисленные неудачные попытки реализовать окно "drop zone", появляющееся при удержании файла над иконкой в доке, привели к решению отказаться от этого сложного и нестабильного подхода в пользу более простых и надежных решений.

## Изученные уроки и инсайты проекта
*   Управление `NSApplication.ActivationPolicy` является ключевым для гибридных приложений (menubar + опциональный dock).
*   Система macOS может временно повышать приоритет приложения до `.regular` для обработки событий, таких как drag-and-drop, даже если изначально оно было `.accessory`.
*   Важно программно возвращать приложение в состояние `.accessory` после выполнения фоновых задач, инициированных пользователем, чтобы сохранить ожидаемое поведение.
*   Попытки перехватить событие "удержания" файла над иконкой в доке (в отличие от "броска") являются сложными и не имеют стандартного решения в AppKit, что делает такие подходы хрупкими.
